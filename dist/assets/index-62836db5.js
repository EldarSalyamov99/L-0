(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const L=document.querySelector(".products__list"),k=document.querySelector(".products__list_missing");document.querySelector(".cart-form__card-btn");const U=document.querySelector(".popup-delivery"),R=document.querySelector(".form-delivery__adress-box-courier"),z=document.querySelector(".form-delivery__adress-box-pickup");document.querySelector(".cart-delivery__images");const H=document.querySelector(".cart-delivery__container"),W=document.querySelectorAll(".edit-card"),Z=document.querySelector(".popup-payment"),X=document.querySelector(".form-payment__list"),K=document.querySelector(".cart-form"),G=document.querySelectorAll(".edit-address"),J=document.querySelector(".order__delivery-date"),Q=document.querySelector(".cart-delivery");document.querySelector(".order__checkbox-input");document.querySelectorAll(".order__paynow-text");document.querySelector(".order__sbt-btn");const a=(o,e)=>{const t=e===void 0?" ":" ";return o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)},q=(o,e)=>{o=Math.abs(o)%100;var t=o%10;return o>10&&o<20?e[2]:t>1&&t<5?e[1]:t==1?e[0]:e[2]},T=["товар","товара","товаров"],Y={formSelector:".cart-form",inputSelector:".user__input",submitButtonSelector:".order__sbt-btn",inputErrorClass:"user__input_error",errorClass:"user__input-error_active"},j=[{input:"username",errorType:"filling",errorText:"Укажите имя"},{input:"userlastname",errorType:"filling",errorText:"Введите фамилию"},{input:"email",errorType:"filling",errorText:"Укажите электронную почту"},{input:"phone",errorType:"filling",errorText:"Укажите номер телефона"},{input:"inn",errorType:"filling",errorText:"Укажите ИНН"},{input:"email",errorType:"validity",errorText:"Проверьте адрес электронной почты"},{input:"phone",errorType:"validity",errorText:"Формат: +9 999 999 99 99"},{input:"inn",errorType:"validity",errorText:"Проверьте ИНН"}];class ee{constructor(e,t,{setLike:s},r,i,n,c,d,l,_){this._elementTemplate=t,this._card=e,this._setLike=s,this._missingCard=r,this._updateProductData=i,this._removeProduct=n,this._updateThumbnails=c,this._prevValue,this._comanyData=d,this._products=l,this._checked=!0,this._toggleThumbnails=_}_getTemplate(e){return document.querySelector(e).content.cloneNode(!0)}generateProduct(){this._cardElement=this._getTemplate(this._elementTemplate),this._cardImg=this._cardElement.querySelector(".product-card__img"),this._cardTitle=this._cardElement.querySelector(".product-card__name"),this._cardBrand=this._cardElement.querySelector(".product-card__brand"),this._propsContainer=this._cardElement.querySelector(".product-card__properties"),this._cardStore=this._cardElement.querySelector(".product-card__store-value"),this._cardCompany=this._cardElement.querySelector(".product-card__company-name"),this._cardAmount=this._cardElement.querySelector(".counter__input"),this._cardRemainder=this._cardElement.querySelector(".product-card__remainder"),this._cardSum=this._cardElement.querySelector(".product-card__sum-value"),this._cardFullSum=this._cardElement.querySelector(".product-card__tlt-sum-value"),this._cardSumDisc=this._cardElement.querySelector(".product-card__disc"),this._cardSumDiscValue=this._cardElement.querySelector(".product-card__disc-value"),this._cardSumConsDisc=this._cardElement.querySelector(".product-card__cost-disc"),this._cardSumCostDiscValue=this._cardElement.querySelector(".product-card__cost-disc-value"),this._deletetBtn=this._cardElement.querySelector(".product-card__actn-btn-delete"),this._likeIcon=this._cardElement.querySelector(".product-card__actn-btn-like"),this._plusBtn=this._cardElement.querySelector(".counter__btn_plus"),this._minusBtn=this._cardElement.querySelector(".counter__btn_minus"),this._tltCompany=this._cardElement.querySelector(".product-card__company-tooltip-name"),this._tltOgrn=this._cardElement.querySelector(".product-card__company-tooltip-ogrn"),this._tltAddress=this._cardElement.querySelector(".product-card__company-tooltip-address"),this._tolltip=this._cardElement.querySelector(".product-card__company-tooltip"),this._productSize=this._cardElement.querySelector(".product-card__size"),this._checkbox=this._cardElement.querySelector(".checkbox__input");const e=this._card;if(this._cardImg.src=e.link,this._cardTitle.textContent=e.brand?`${e.title}, ${e.brand}`:e.title,this._cardTitle.alt=e.title,this._setSizeData(e,this._productSize),!this._missingCard){this._cardStore.textContent=e.store,this._cardCompany.textContent=e.company,this._cardAmount.value=e.amount.reduce((s,r)=>s+r.amount,0),this._prevValue=e.amount.reduce((s,r)=>s+r.amount,0);const t=this._comanyData.find(s=>s.company===e.company);this._tltCompany.textContent=t.companyTooltip,this._tltOgrn.textContent=t.ogrn,this._tltAddress.textContent=t.address,this._products.findIndex(s=>s.id===e.id)===0?this._tolltip.classList.add("product-card__company-tooltip_top"):this._tolltip.classList.remove("product-card__company-tooltip_top"),this._updateSum(),this._updateLeftovers(),this._toggleCounterActivity()}return this._generateFromArray(this._card.props,"span","product-card__prop-value",this._propsContainer),this._setEventListeners(),this._cardElement}_generateFromArray(e,t,s,r){e.length===0?r.classList.add("product-card__properties_inactive"):(r.classList.remove("product-card__properties_inactive"),e.forEach(i=>{const n=document.createElement(t);n.textContent=i,n.classList.add(s),i.includes("Размер")&&n.classList.add("product-card__prop-value_hidden"),r.appendChild(n)}))}_setSizeData(e,t){const s=e.props.find(r=>r.includes("Размер"));if(s){const r=parseInt(s.replace(/\D/g,""),10);t.textContent=r,t.classList.add("product-card__size_active")}}_toggleLike(e){e.target.classList.toggle("product-card__actn-btn-like_active")}_removeCard(){this._deletetBtn.closest(".product-card").remove(),this._removeProduct(this._card.title,this._missingCard,this._card.id)}_increaseCounter(){const e=parseInt(this._cardAmount.value);if(this._card.remainder-e>0){const t=e+1;this._cardAmount.value=t,this._prevValue=t,this._updateSum(),this._updateLeftovers(),this._toggleCounterActivity(),this._updateThumbnails(this._card,t,e)}}_decreaseCounter(){const e=parseInt(this._cardAmount.value);if(e>1){const t=e-1;this._cardAmount.value=t,this._prevValue=t,this._updateSum(),this._updateLeftovers(),this._toggleCounterActivity(),this._updateThumbnails(this._card,t,e)}}_changeInputCounter(e){const t=parseInt(e);t<1&&(this._cardAmount.value=1),this._card.remainder-t<0&&(this._cardAmount.value=this._card.remainder),this._updateSum(),this._updateLeftovers(),this._toggleCounterActivity(),this._updateThumbnails(this._card,parseInt(this._cardAmount.value,10),this._prevValue),this._prevValue=parseInt(this._cardAmount.value,10)}_updateSum(){const e=parseInt(this._cardAmount.value),t=Math.round(this._card.price*e),s=Math.round(this._card.price*(1-this._card.disc)*e),r=Math.round(this._card.price*e*this._card.disc),i=Math.round(this._card.price*e*this._card.disc*this._card.costDisc);this._cardSum.textContent=a(s),this._cardFullSum.textContent=a(t)+" сом",this._cardSum.title=this._cardSum.textContent+" сом",s>9999?this._cardSum.classList.add("product-card__sum-value_small"):this._cardSum.classList.remove("product-card__sum-value_small"),this._cardSumDiscValue.textContent=`−${a(r)} сом`,this._cardSumCostDiscValue.textContent=`−${a(i)} сом`,this._updateProductData({product:this._card.title,price:s,amount:e,fullPrice:t,checked:this._checked,id:this._card.id,inOneStock:this._card.inOneStock})}_updateLeftovers(){const e=parseInt(this._cardAmount.value);this._card.remainder-e<3?(this._cardRemainder.textContent=`Осталось ${this._card.remainder-e} шт.`,this._cardRemainder.style.display==="none"&&(this._cardRemainder.style.display="block")):this._cardRemainder.style.display="none"}_toggleCounterActivity(){const e=parseInt(this._cardAmount.value);e<2?this._minusBtn.classList.add("counter__btn_inactive"):this._minusBtn.classList.contains("counter__btn_inactive")&&this._minusBtn.classList.remove("counter__btn_inactive"),this._card.remainder-e===0?this._plusBtn.classList.add("counter__btn_inactive"):this._plusBtn.classList.contains("counter__btn_inactive")&&this._plusBtn.classList.remove("counter__btn_inactive")}_handleCheckBox(e){e?this._checked=!0:this._checked=!1,this._updateSum(),e?this._toggleThumbnails(this._card,this._prevValue):this._toggleThumbnails(this._card,0)}_setEventListeners(){this._likeIcon.addEventListener("click",e=>{this._toggleLike(e)}),this._deletetBtn.addEventListener("click",()=>{this._removeCard()}),this._plusBtn&&this._plusBtn.addEventListener("click",()=>{this._increaseCounter()}),this._minusBtn&&this._minusBtn.addEventListener("click",()=>{this._decreaseCounter()}),this._cardAmount&&this._cardAmount.addEventListener("change",e=>{this._changeInputCounter(e.target.value)}),this._checkbox&&this._checkbox.addEventListener("change",e=>{this._handleCheckBox(e.target.checked)})}}class I{constructor({items:e,renderer:t},s,r,i){this._renderedItems=e,this._renderer=t,this._container=s,this._listSelector=document.querySelector(r),this.addItem=this.addItem.bind(this),this._accordionIcon=this._listSelector.querySelector(".products__accordion-icon"),this._productList=this._listSelector.querySelector(".products__list"),this._accordionAmount=this._listSelector.querySelector(".products__accordion-amount"),this._accordionAmountMissing=this._listSelector.querySelector(".products__accordion-amount-missing"),this._accordionSum=this._listSelector.querySelector(".products__accordion-sum"),this._orderSum=document.querySelector(".order__sum-main-value"),this._orderAmount=document.querySelector(".order__amount"),this._orderTotalPrice=document.querySelector(".order__sum-no-disc"),this._orderDiscount=document.querySelector(".order__sum-discount"),this._payNowCheckbox=document.querySelector(".order__checkbox-input"),this._payNowText=document.querySelectorAll(".order__paynow-text"),this._formSubmitBtn=document.querySelector(".order__sbt-btn"),this._cartProductsAmount=document.querySelectorAll(".navbar__number"),this._handlePayNowCheckbox=this._handlePayNowCheckbox.bind(this),this._mainCheckbox=this._listSelector.querySelector(".product__checkbox-all"),this._productsData,this._toggleThumbnails=i}renderItems(){const e=this._renderedItems.reverse();e.forEach(t=>{this._renderer(t)}),this._updateAccordionHeight(),this._accordionAmountMissing&&this._getMissingProductsData(e)}updateAccordionData(e){this._productsData=e,this._mainCheckbox&&this._updateCheckbox(e);const t=e.filter(r=>r.checked);this._totalAmount=t.reduce((r,i)=>r+i.amount,0),this._totalSum=t.reduce((r,i)=>r+i.price,0),this._fullPrice=t.reduce((r,i)=>r+i.fullPrice,0),e.length===0&&!this._accordionAmountMissing?this._productList.classList.add("products__list_high"):this._productList.classList.remove("products__list_high");const s=`${a(this._totalAmount)} ${q(this._totalAmount,T)}`;if(this._accordionAmountMissing)this._getMissingProductsData(e);else{this._accordionAmount.textContent=`${s} ·`;const r=a(this._totalSum);this._accordionSum.textContent=r+" сом",this._orderSum.textContent=a(this._totalSum," "),this._orderSum.title=r+" сом",this._orderAmount.textContent=s,this._orderTotalPrice.textContent=a(this._fullPrice," ")+" сом",this._orderDiscount.textContent=a(this._fullPrice-this._totalSum)+" сом",this._updateSbtnBtn(r);const i=Array.from(this._cartProductsAmount);e.length===0?i.forEach(n=>{n.parentElement.classList.add("navbar__number-box_inactive")}):i.forEach(n=>{n.parentElement.classList.remove("navbar__number-box_inactive"),n.textContent=e.length})}}_updateSbtnBtn(e){this._payNowCheckbox.checked&&(this._formSubmitBtn.textContent=`Оплатить ${e} сом`),this._totalAmount===0?(this._formSubmitBtn.classList.add("order__sbt-btn_inactive"),this._formSubmitBtn.disabled=!0,this._payNowCheckbox.disabled=!0,this._formSubmitBtn.textContent="Заказать"):(this._formSubmitBtn.classList.remove("order__sbt-btn_inactive"),this._formSubmitBtn.disabled=!1,this._payNowCheckbox.disabled=!1)}_handlePayNowCheckbox(e){const t=Array.from(this._payNowText);e.target.checked?(t.forEach(s=>{s.classList.add("order__paynow-text_inactive")}),this._formSubmitBtn.textContent=`Оплатить ${a(this._orderSum.textContent)} сом`):(t.forEach(s=>{s.classList.remove("order__paynow-text_inactive")}),this._formSubmitBtn.textContent="Заказать")}removeAccordionItem(e){this.updateAccordionData(e),this._updateAccordionHeight()}_updateAccordionHeight(){this._productListHeight=this._productList.offsetHeight,this._productList.style.maxHeight=this._productListHeight+250+"px"}_getMissingProductsData(e){const t=e.length.toString(),s=t.substring(t.length-1)==="1"?"Отсутствует":"Отсутствуют";this._accordionAmountMissing.textContent=`${s} · ${a(e.length)} ${q(e.length,T)}`,e.length===1?this._productList.classList.add("products__list_high"):this._productList.classList.remove("products__list_high"),e.length===0?this._listSelector.classList.add("products_high"):this._listSelector.classList.remove("products_high")}addItem(e,t){t.prepend(e)}_handleAccordion(){this._listSelector.classList.contains("products_hidden")?this._productList.style.maxHeight=this._productListHeight+"px":this._productList.style.maxHeight=0,this._listSelector.classList.toggle("products_hidden")}_handleAllCheckboxes(e){this._productsData.forEach(s=>{s.checked=e,e?this._toggleThumbnails(s,s.amount):this._toggleThumbnails(s,0)}),Array.from(document.querySelectorAll(".product-card__checkbox-input")).forEach(s=>{s.checked=e}),this.updateAccordionData(this._productsData)}_updateCheckbox(e){e.some(t=>!t.checked)?this._mainCheckbox.checked=!1:this._mainCheckbox.checked=!0}setEventListeners(){this._accordionIcon.addEventListener("click",()=>{this._handleAccordion()}),this._accordionAmountMissing||this._payNowCheckbox.addEventListener("click",this._handlePayNowCheckbox),this._mainCheckbox&&this._mainCheckbox.addEventListener("click",e=>{this._handleAllCheckboxes(e.target.checked)})}}class B{constructor(e){this._popupSelector=e,this.closePopup=this.closePopup.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this),this._handleEscClose=this._handleEscClose.bind(this),this._pageElement=document.querySelector(".page")}openPopup(){this._popupSelector.classList.add("popup_opened"),document.body.classList.add("body_unscrolled"),this._pageElement.classList.add("page_scrolled"),document.addEventListener("mousedown",this._handleOverlayClose),document.addEventListener("keydown",this._handleEscClose)}closePopup(){this._popupSelector.classList.remove("popup_opened"),setTimeout(()=>{document.body.classList.remove("body_unscrolled"),this._pageElement.classList.remove("page_scrolled")},200),document.removeEventListener("mousedown",this._handleOverlayClose),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){const t=document.querySelector(".popup_opened");e.key==="Escape"&&this.closePopup(t)}_handleOverlayClose(e){const t=document.querySelector(".popup_opened");e.target.classList.contains("popup_opened")&&this.closePopup(t)}setEventListeners(){this._popupSelector.querySelector(".popup__close-btn").addEventListener("click",this.closePopup)}}class te extends B{constructor(e,t,s,r,i){super(e),this._addressTemplate=t,this._formElement=this._popupSelector.querySelector(".form-delivery"),this._popupSbtBtn=this._formElement.querySelector(".popup__sbt-btn"),this._deliveryBtnCourier=this._popupSelector.querySelector(".form-delivery__del-courier"),this._deliveryBtnPickup=this._popupSelector.querySelector(".form-delivery__del-pickup"),this._courierAddressBox=this._popupSelector.querySelector(".form-delivery__adress-box-courier"),this._pickupAddressBox=this._popupSelector.querySelector(".form-delivery__adress-box-pickup"),this._initialSbtBtn=this._popupSbtBtn.textContent,this._toggleDeliveryType=this._toggleDeliveryType.bind(this),this.toggleAddresses=s,this._initialAddress={courier:r.address,pickUp:i.address,activeType:"pickUp",rating:0},this._selectedAddress={courier:r.address,pickUp:i.address,activeType:"pickUp",rating:0},this._submittedAddress}openPopup(){super.openPopup(),this._updateAddressBoxWidth([this._courierAddressBox,this._pickupAddressBox]),this._dropData()}_closePopup(){super.closePopup()}_dropData(){const e=this._popupSelector.querySelectorAll(".radio-btn__value");if(this._submittedAddress){const t=Array.from(e).find(n=>n.textContent===this._submittedAddress[this._submittedAddress.activeType]),s=this._submittedAddress.activeType==="pickUp"?"courier":"pickUp",r=Array.from(e).find(n=>n.textContent===this._initialAddress[s]);t&&(t.nextElementSibling.checked=!0),r&&(r.nextElementSibling.checked=!0);const i=this._submittedAddress.activeType==="pickUp"?this._deliveryBtnPickup:this._deliveryBtnCourier;this._toggleDeliveryType(i)}else{const t=Array.from(e).find(i=>i.textContent===this._initialAddress.courier),s=Array.from(e).find(i=>i.textContent===this._initialAddress.pickUp);t&&(t.nextElementSibling.checked=!0),s&&(s.nextElementSibling.checked=!0);const r=this._initialAddress.activeType==="pickUp"?this._deliveryBtnPickup:this._deliveryBtnCourier;this._toggleDeliveryType(r)}}_getTemplate(){return document.querySelector(this._addressTemplate).content.cloneNode(!0)}generateAddress(e){this._address=this._getTemplate(),this._addressValue=this._address.querySelector(".radio-btn__value"),this._input=this._address.querySelector(".radio-btn__input"),this._deleteBtn=this._address.querySelector(".form-delivery__dlt-btn"),this._rating=this._address.querySelector(".form-delivery__rating-value"),this._addressValue.textContent=e.address,this._input.name=e.type,this._input.checked=e.checked,e.rating>0?(this._rating.textContent=e.rating,this._rating.classList.remove("form-delivery__rating-value_inactive")):this._rating.classList.add("form-delivery__rating-value_inactive");const t=this._deleteBtn.closest(".form-delivery__adress-wrapper");return this._setInnerEventListeners(t,e),this._address}_toggleDeliveryType(e){e.classList.contains("form-delivery__del-type_active")||(this._deliveryBtnCourier.textContent===e.textContent?(this._deliveryBtnPickup.classList.remove("form-delivery__del-type_active"),this._deliveryBtnCourier.classList.add("form-delivery__del-type_active"),this._selectedAddress.activeType="courier",this._toggleSbtBtnActivity()):(this._deliveryBtnPickup.classList.add("form-delivery__del-type_active"),this._deliveryBtnCourier.classList.remove("form-delivery__del-type_active"),this._selectedAddress.activeType="pickUp",this._toggleSbtBtnActivity()),this.toggleAddresses(),this._updateAddressBoxWidth([this._courierAddressBox,this._pickupAddressBox]))}_removeAddress(e,t){e.remove(),this._updateActiveRadioBtn(t),this._toggleSbtBtnActivity(),this._updateAddressBoxWidth([this._courierAddressBox,this._pickupAddressBox])}_updateActiveRadioBtn(e){const s=(e.type==="pickUp"?this._pickupAddressBox:this._courierAddressBox).querySelectorAll(".radio-btn__input");let r=!1;for(const i of s)if(i.checked){r=!0;break}!r&&s.length>0&&(s[0].checked=!0,this._handleAddressChange({type:e.type,address:s[0].labels[0].innerText})),s.length===0&&this._handleAddressChange({type:e.type,address:""})}_toggleSbtBtnActivity(){this._selectedAddress[this._selectedAddress.activeType]===""?this._popupSbtBtn.classList.add("popup__sbt-btn_inactive"):this._popupSbtBtn.classList.remove("popup__sbt-btn_inactive")}_handleAddressChange(e){this._selectedAddress[e.type]=e.address,this._selectedAddress.rating=e.rating}_updateAddressBoxWidth(e){e.forEach(t=>{t.scrollHeight>t.clientHeight?t.classList.add("form-delivery__adress-box_wide"):t.classList.remove("form-delivery__adress-box_wide")})}_submitForm(e){e.preventDefault(),this._newAddress=this._selectedAddress[this._selectedAddress.activeType],this._submittedAddress={courier:this._selectedAddress.courier,pickUp:this._selectedAddress.pickUp,activeType:this._selectedAddress.activeType,rating:0},this._newAddress!==""&&(this._selectedAddressElement=document.querySelector(".cart-delivery__address"),this._selectedAddressRating=document.querySelector(".cart-delivery__rating-value"),this._pickupAddressData=document.querySelector(".cart-delivery__address-data"),this._orderAddress=document.querySelector(".order__selected-address"),this._selectedAddressElement.textContent=this._newAddress,this._orderAddress.textContent=this._newAddress,this._selectedAddress.activeType==="pickUp"?(this._selectedAddress.rating>0?this._selectedAddressRating.textContent=this._selectedAddress.rating:this._selectedAddressRating.textContent="",this._pickupAddressData.classList.remove("cart-delivery__address-data_inactive")):this._pickupAddressData.classList.add("cart-delivery__address-data_inactive"),this._closePopup())}_setInnerEventListeners(e,t){this._deleteBtn.addEventListener("click",()=>this._removeAddress(e,t)),this._input.addEventListener("change",()=>this._handleAddressChange(t))}setEventListeners(){super.setEventListeners(),this._deliveryBtnCourier.addEventListener("click",e=>this._toggleDeliveryType(e.target)),this._deliveryBtnPickup.addEventListener("click",e=>this._toggleDeliveryType(e.target)),this._formElement.addEventListener("submit",e=>this._submitForm(e))}}class D{constructor({renderer:e},t,s){this._renderedItems=t,this._renderer=e,this._container=s,this.toggleAddresses=this.toggleAddresses.bind(this)}renderItems(){this._renderedItems.reverse().forEach(t=>{this._renderer(t)})}addItem(e){this._container.prepend(e)}toggleAddresses(){this._container.classList.toggle("form-delivery__adress-box_inactive")}setEventListeners(){}}class se{constructor(e,t,s){this._renderedItems=e,this._container=t,this._elementTemplate=s,this._orderDates=document.querySelector(".order__delivery-date")}_getTemplate(e){return document.querySelector(e).content.cloneNode(!0)}_generateThumbnails(e){return this._imageBox=this._getTemplate("#thumbnail"),this._imageElement=this._imageBox.querySelector(".cart-delivery__image-box"),this._imgSrc=this._imageBox.querySelector(".cart-delivery__image"),this._productAmount=this._imageBox.querySelector(".cart-delivery__product-amount"),this._imageElement.dataset.productId=e.id,this._imgSrc.src=e.thumbnail,this._productAmount.textContent=e.amount,e.amount>9&&e.amount<100?this._productAmount.parentElement.classList.add("cart-delivery__amount-box_low"):this._productAmount.parentElement.classList.remove("cart-delivery__amount-box_low"),this._updateNumberStyle(e.amount,this._productAmount),this._imageBox}_updateNumberStyle(e,t){e>1?t.classList.remove("cart-delivery__product-amount_inactive"):t.classList.add("cart-delivery__product-amount_inactive"),e>9?t.classList.add("cart-delivery__product-amount_wide"):t.classList.remove("cart-delivery__product-amount_wide")}_generateDates(e){return this._dateBox=this._getTemplate("#delivery-date-template"),this._thumbnailBox=this._dateBox.querySelector(".cart-delivery__images"),this._deliveryDate=this._dateBox.querySelector(".cart-delivery__date"),this._deliveryDate.textContent=e.date,e.products.reverse().forEach(t=>{const s=this._generateThumbnails(t);this._addItem(this._thumbnailBox,s)}),this._dateBox}renderItems(){this._renderedItems.reverse().forEach(t=>{const s=this._generateDates(t);this._addItem(this._container,s)})}_addItem(e,t){e.prepend(t)}toggleThumbnails(e,t){const s=Array.from(document.querySelectorAll(`[data-product-id="${e.id}"]`));t===0?s.forEach(r=>{r.classList.add("cart-delivery__image-box_inactive");const i=r.closest(".cart-delivery__row");Array.from(i.querySelectorAll(".cart-delivery__image-box")).every(c=>c.classList.contains("cart-delivery__image-box_inactive"))?i.classList.add("cart-delivery__row_inactive"):i.classList.remove("cart-delivery__row_inactive")}):(this._imageElement.classList.remove("cart-delivery__image-box_inactive"),s.forEach(r=>{r.classList.remove("cart-delivery__image-box_inactive"),r.closest(".cart-delivery__row").classList.remove("cart-delivery__row_inactive")}))}updateThumbnails(e,t,s){const r=document.querySelectorAll(`[data-product-id="${e.id}"]`),i=r[0].querySelector(".cart-delivery__product-amount"),n=r[r.length-1].querySelector(".cart-delivery__product-amount"),c=n.closest(".cart-delivery__row"),d=t-s;if(t>e.inOneStock&&c.classList.contains("cart-delivery__row_inactive")){c.classList.remove("cart-delivery__row_inactive"),this._getSummaryDatesDelivery(),i.textContent=e.inOneStock,n.textContent=t-e.inOneStock,this._updateNumberStyle(e.inOneStock,i),this._updateNumberStyle(t-e.inOneStock,n);return}if(r.length===1||c.classList.contains("cart-delivery__row_inactive"))i.textContent=t,this._updateNumberStyle(t,i);else if(d>0)n.textContent=parseInt(n.textContent,10)+d,this._updateNumberStyle(parseInt(n.textContent,10)+d,n);else{let l=d*-1;const _=Array.from(r).reverse();for(let u=0;u<_.length;u++){const h=_[u].querySelector(".cart-delivery__product-amount"),m=parseInt(h.textContent);if(m-1>=l){h.textContent=m-l,this._updateNumberStyle(m-l,h);break}else h.textContent=m-l,l=l-m,_[u].closest(".cart-delivery__row").classList.add("cart-delivery__row_inactive"),this._getSummaryDatesDelivery()}}}_getSummaryDatesDelivery(){let e="";const t=Array.from(document.querySelectorAll(".cart-delivery__row:not(.cart-delivery__row_inactive) .cart-delivery__date"));if(t.length===0){this._orderDates.classList.add("order__delivery-date_inactive");return}else if(this._orderDates.classList.remove("order__delivery-date_inactive"),t.length===1)e=t[0].textContent;else{const l=t[0].textContent,_=t[t.length-1].textContent,u=l.split("—")[0],h=_.split("—")[1];e=`${u}—${h}`}const s=e.split("—"),r=s[0].trim(),i=s[1].trim(),[n,c]=i.split(" "),d=`${r}–${n} ${c.substring(0,3)}`;this._orderDates.textContent=d}removeThumbnail(e){const t=document.querySelectorAll(`[data-product-id="${e}"]`);Array.from(t).forEach(s=>{!s.nextElementSibling&&!s.previousElementSibling?s.closest(".cart-delivery__row").remove():s.remove()}),this._getSummaryDatesDelivery()}}class re extends B{constructor(e,t,s,r){super(e),this._cardTemplate=t,this._renderedItems=s,this._container=r,this._selectedCard=s.find(i=>i.checked),this._formElement=this._popupSelector.querySelector(".form-payment"),this._initialCard=s.find(i=>i.checked),this._submittedCard}openPopup(){super.openPopup(),this._droppData()}_closePopup(){super.closePopup()}_getTemplate(){return document.querySelector(this._cardTemplate).content.cloneNode(!0)}_generateCard(e){return this._card=this._getTemplate(),this._icon=this._card.querySelector(".form-payment__card-icon"),this._number=this._card.querySelector(".form-payment__card-number"),this._input=this._card.querySelector(".radio-btn__input"),this._icon.src=e.logo,this._icon.alt=e.name,this._number.textContent=e.number,this._input.checked=e.checked,this._input.name="card",this._setInnerEventListeners(e),this._updateCardData(),this._card}_droppData(){const e=this._popupSelector.querySelectorAll(".form-payment__card-number");if(this._submittedCard){const t=Array.from(e).find(s=>s.textContent===this._submittedCard.number);t.closest(".form-payment__radio-btn").control.checked=!0}else{const t=Array.from(e).find(s=>s.textContent===this._initialCard.number);t.closest(".form-payment__radio-btn").control.checked=!0}}renderItems(){this._renderedItems.reverse().forEach(t=>{const s=this._generateCard(t);this._addItem(s)})}_addItem(e){this._container.prepend(e)}_handleCardChange(e){this._selectedCard=e}_updateCardData(){this._orderCardIcon=document.querySelector(".order__icon-card"),this._orderCardNumber=document.querySelector(".order__card-number"),this._cartCardIcon=document.querySelector(".cart-payment__card-icon"),this._cartCardNumber=document.querySelector(".cart-payment__card-number"),this._cartCardValidity=document.querySelector(".cart-payment__card-date"),this._orderCardIcon.src=this._selectedCard.logo,this._orderCardIcon.alt=this._selectedCard.name,this._orderCardNumber.textContent=this._selectedCard.number,this._cartCardIcon.src=this._selectedCard.logo,this._cartCardIcon.alt=this._selectedCard.name,this._cartCardNumber.textContent=this._selectedCard.number,this._cartCardValidity.textContent=this._selectedCard.validity}_submitForm(e){e.preventDefault(),this._updateCardData(),this._submittedCard=this._selectedCard,this._closePopup()}_setInnerEventListeners(e){this._input.addEventListener("change",()=>this._handleCardChange(e))}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",e=>this._submitForm(e))}}class ie{constructor(e,t,s){this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._inputErrors=s,this._innInput=this._formElement.querySelector(".user__input-info")}_showError(e,t){const s=e.closest(".user__input-container").querySelector(".user__input-error"),r=this._inputErrors.find(i=>i.input===e.name&&i.errorType===t).errorText;e.name==="inn"&&(this._innInput.classList.add("user__input-info_inactive"),s.classList.remove("user__input-error_hidden")),e.classList.add(this._inputErrorClass),e.classList.add(this._inputErrorClass+"_"+t),s.classList.add(this._errorClass),s.textContent=r}_hideError(e){const t=e.closest(".user__input-container").querySelector(".user__input-error");e.name==="inn"&&(this._innInput.classList.remove("user__input-info_inactive"),t.classList.add("user__input-error_hidden")),e.classList.remove(this._inputErrorClass,this._inputErrorClass+"_filling",this._inputErrorClass+"_validity"),t.classList.remove(this._errorClass)}_checkEmailValidation(e){return/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(e)}_checkPhoneValidation(e){const t=e.replace(/\s/g,"");return/^\+9\d{3}\d{3}\d{2}\d{2}$/.test(t)}_checkInnValidation(e){return e.length===14}_validateInput(e,t){return e==="email"?this._checkEmailValidation(t):e==="phone"?this._checkPhoneValidation(t):e==="inn"?this._checkInnValidation(t):!0}_formatPhoneNumber(e){const t=/[^\d+()\-]/g,s=e.replace(t,"").slice(0,30);let r="";for(let i=0;i<s.length;i++)i===2||i===5||i===8||i===10?r=r+" "+s[i]:r=r+s[i];return r}_formanInn(e){return e=e.replace(/\D/g,"").slice(0,14),e}_checkInputValidity(e,t){const s=this._validateInput(e.name,e.value);return e.value!==""?e.labels[0].classList.add("user__label_filled"):e.labels[0].classList.remove("user__label_filled"),e.value===""&&t?(this._showError(e,"filling"),!1):!s&&e.value!==""?(this._showError(e,"validity"),!1):(this._hideError(e),!0)}_checkInputTypingValidity(e){if(e.value!==""){const t=this._validateInput(e.name,e.value);e.classList.contains("user__input_error_validity")?e.classList.contains("user__input_error")&&(t?this._hideError(e):this._showError(e,"validity")):this._hideError(e)}}_setInputListeners(){this._inputList.forEach(e=>{e.addEventListener("change",()=>{this._checkInputValidity(e,!1)})})}_setInputTypingListeners(){this._inputList.forEach(e=>{e.addEventListener("input",()=>{this._checkInputTypingValidity(e)})})}_setAdditionalListeners(){const e=this._inputList.filter(s=>s.name==="phone")[0],t=this._inputList.filter(s=>s.name==="inn")[0];e.addEventListener("focus",()=>{e.value||(e.value="+9 ")}),e.addEventListener("input",s=>{const r=s.target.value,i=this._formatPhoneNumber(r);s.target.value=i}),e.addEventListener("blur",()=>{e.value==="+9 "&&(e.value="")}),t.addEventListener("input",()=>{t.value=this._formanInn(t.value)})}_checkFormValidity(){const e=[];return this._inputList.forEach(t=>{const s=this._checkInputValidity(t,!0);e.push({input:t.name,validity:s})}),!e.some(t=>!t.validity)}_scrollToTarget(e){e.scrollIntoView({behavior:"smooth"})}_submitForm(e){if(e.preventDefault(),this._checkFormValidity())alert("The order has been sent");else{const s=this._formElement.querySelector(".user");this._scrollToTarget(s)}}enableValidation(){this._formElement.addEventListener("submit",e=>this._submitForm(e)),this._setAdditionalListeners(),this._setInputListeners(),this._setInputTypingListeners()}}const P="/assets/photo1-0240ce6c.webp",w="/assets/photo2-7dc94943.webp",O="/assets/photo3-0693faf5.webp",oe="/assets/photo1-small-5fa980a5.webp",ne="/assets/photo2-small-402b9608.webp",ce="/assets/photo3-small-63bdaf2b.webp",ae="/assets/mir-03a959ec.svg",de="/assets/visa-150135ed.svg",le="/assets/mastercard-8094c5c3.svg",_e="/assets/maestro-3b401faa.svg",b=[{link:P,id:"element1",title:"Футболка UZcotton мужская",brand:"",props:["Цвет: белый","Размер: 56"],store:"Коледино WB",company:"OOO Вайлдберриз",companyData:"Test",amount:[{date:"5—6 февраля",amount:1}],inOneStock:4,remainder:3,price:1051,disc:.5033,costDisc:.1,missing:!0,thumbnail:oe},{link:w,id:"element2",title:"Силиконовый чехол картхолдер (отверстия) для карт, прозрачный кейс бампер на Apple iPhone XR",brand:"MobiSafe",props:["Цвет: прозрачный"],store:"Коледино WB",company:"OOO Мегапрофстиль",companyData:"Company data will be here",amount:[{date:"5—6 февраля",amount:184},{date:"7—8 февраля",amount:16}],inOneStock:184,remainder:1e6,price:11500.235,disc:.0869548,costDisc:.1,missing:!0,thumbnail:ne},{link:O,id:"element3",title:'Карандаши цветные Faber-Castell "Замок", набор 24 цвета, заточенные, шестигранные',brand:"Faber‑Castell",props:[],store:"Коледино WB",company:"OOO Вайлдберриз",companyData:"Company data will be here",amount:[{date:"5—6 февраля",amount:2}],inOneStock:6,remainder:4,price:475,disc:.48,costDisc:.1,missing:!0,thumbnail:ce}],v={};b.forEach(o=>{o.amount.forEach(t=>{const{date:s,amount:r}=t,i={id:o.id,amount:r,title:o.title,thumbnail:o.thumbnail};v[s]?v[s].products.push(i):v[s]={date:s,products:[i]}})});const ue=Object.values(v),V=[{link:P,title:"Футболка UZcotton мужская",brand:"",props:["Цвет: белый","Размер: 56"],store:"Коледино WB",company:"OOO Вайлдберриз",companyData:"Test",amount:1,remainder:2,price:1051,disc:.5033,costDisc:.1,missing:!0},{link:w,title:"Силиконовый чехол картхолдер (отверстия) для карт, прозрачный кейс бампер на Apple iPhone XR",brand:"MobiSafe",props:["Цвет: прозрачный"],store:"Коледино WB",company:"OOO Мегапрофстиль",companyData:"Company data will be here",amount:200,remainder:"",price:11500.235,disc:.0869548,costDisc:.1,missing:!0},{link:O,title:'Карандаши цветные Faber-Castell "Замок", набор 24 цвета, заточенные, шестигранные',brand:"Faber-Castell",props:[],store:"Коледино WB",company:"OOO Вайлдберриз",companyData:"Company data will be here",amount:2,remainder:2,price:475,disc:.48,costDisc:.1,missing:!0}],N=[{address:"Бишкек, улица Табышалиева, 57",checked:!0,type:"courier"},{address:"Бишкек, улица Жукеева-Пудовкина, 77/1",checked:!1,type:"courier"},{address:"Бишкек, микрорайон Джал, улица Ахунбаева Исы, 67/1",checked:!1,type:"courier"}],$=[{address:"Бишкек, улица Ахматбека Суюмбаева, 12/1",rating:0,checked:!0,type:"pickUp"},{address:"Бишкек, микрорайон Джал, улица Ахунбаева Исы, д. 67/1 ",rating:4.99,checked:!1,type:"pickUp"},{address:"Бишкек, улица Табышалиева, д. 57 ",rating:4.99,checked:!1,type:"pickUp"}],he=[{number:"1234 56•• •••• 1234",logo:ae,name:"Карта Мир",validity:"01/30",checked:!0},{number:"1234 56•• •••• 1235",logo:de,name:"Карта Visa",validity:"01/30",checked:!1},{number:"1234 56•• •••• 1236",logo:le,name:"Карта MasterCard",validity:"01/30",checked:!1},{number:"1234 56•• •••• 1237",logo:_e,name:"Maestro",validity:"01/30",checked:!1}],me=[{company:"OOO Мегапрофстиль",companyTooltip:"OOO «МЕГАПРОФСТИЛЬ»",ogrn:"ОГРН: 5167746237148",address:"129337, Москва, улица Красная Сосна, 2, корпус 1, стр. 1, помещение 2, офис 34"},{company:"OOO Вайлдберриз",companyTooltip:"ООО «Вайлдберриз»",ogrn:"ОГРН: 1067746062449",address:"142181, Московская область, г. Подольск, деревня Коледино, Территория Индустриальный парк Коледино, д. 6, стр. 1"}],p=[],pe=V,g=new se(ue,H,"#delivery-date-template"),S=new re(Z,"#bank-card-template",he,X),C=new te(U,"#adressTemplate",be,N[0],$[0]),ye=new ie(Y,K,j),A=new D({renderer:o=>M(o,A)},N,R),E=new D({renderer:o=>M(o,E)},$,z),y=new I({items:b,renderer:o=>{F(o,"#productTemplate",y,!1,L)}},L,"#products-main",x),f=new I({items:V,renderer:o=>{F(o,"#missingProductTemplate",f,!0,k)}},k,"#products-missing",x);function F(o,e,t,s,r){const n=new ee(o,e,{setLike:(c,d)=>{setLike(c,d)}},s,ve,ge,fe,me,b,x).generateProduct();t.addItem(n,r)}function M(o,e){const t=C.generateAddress(o);e.addItem(t)}function ve(o){const e=p.findIndex(t=>t.product===o.product);e!==-1?p[e]=o:p.push(o),y.updateAccordionData(p)}function ge(o,e,t){const s=e?pe:p,r=s.findIndex(i=>i.product===o);s.splice(r,1),e?f.removeAccordionItem(s):(y.removeAccordionItem(s),g.removeThumbnail(t))}function fe(o,e,t){g.updateThumbnails(o,e,t)}function x(o,e){g.toggleThumbnails(o,e)}function be(){A.toggleAddresses(),E.toggleAddresses()}f.renderItems();y.renderItems();A.renderItems();E.renderItems();g.renderItems();S.renderItems();document.addEventListener("DOMContentLoaded",()=>{function o(e){e.scrollIntoView({behavior:"smooth"})}J.addEventListener("click",()=>o(Q))});G.forEach(o=>{o.addEventListener("click",()=>{C.openPopup()})});W.forEach(o=>{o.addEventListener("click",()=>{S.openPopup()})});y.setEventListeners();f.setEventListeners();C.setEventListeners();S.setEventListeners();ye.enableValidation();
